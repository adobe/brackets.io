<!DOCTYPE html>
<html lang="en">
  <head>
    <title>HTMLInstrumentation - Brackets API</title>
    <link rel="stylesheet" href="../../../../../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../../../../../assets/css/typeahead.js-bootstrap.css">
    <link rel="stylesheet" href="../../../../../assets/css/font-awesome.css">
    <link rel="stylesheet" href="../../../../../assets/css/prism.css">
    <link rel="stylesheet" href="../../../../../assets/css/main.css">
    <!--[if IE 7]>
    <link rel="stylesheet" href="../assets/css/font-awesome-ie7.css">
    <![endif]-->
    <script type="text/javascript" src="../../../../../assets/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="../../../../../assets/js/bootstrap.js"></script>
    <script type="text/javascript" src="../../../../../assets/js/typeahead.js"></script>
    <script type="text/javascript" src="../../../../../assets/js/main.js"></script>
    <script src="http://use.edgefonts.net/source-sans-pro:n3,i3,n4,i4;source-code-pro.js"></script>

    <!-- Control the Flash of Unstyled Text (or FOUT) -->
    <style type="text/css">
        .wf-loading h1, .wf-loading h2, .wf-loading h3, .wf-loading h4,
        .wf-loading h5, .wf-loading h6, .wf-loading p, .wf-loading a {
            visibility: hidden;
        }
    </style>
    
    <script>
      window.moduleLevel = "../../../../..";
    </script>
  </head>
  
  <body>
    <div class="row-fluid">
      <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
          <div class="container">
            <a class="brand" href="../../../../../index.html">Brackets API</a>
            <div class="nav-collapse collapse">
              <ul class="nav">
                <li><a href="#dependencies">Dependencies</a></li>
                <li><a href="#variables">Variables</a></li>
                <li><a href="#functions">Functions</a></li>
                <li><a href="#classes">Classes</a></li>
              </ul>
            </div>
            <input class="typeahead" placeholder="Search..." type="text" >
          </div>
        </div>
      </div>    </div>
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="left-section">
            <h2 class="number-of-modules">Modules (188)</h2>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src"><i class="icon-folder-open"></i>src</a>
              </li>
            </ul>
            <ul id="package_src" class="nav nav-list">
              <li><a href="../../../../../modules/src/brackets.html">brackets</a></li>
              <li><a href="../../../../../modules/src/dependencies.html">dependencies</a></li>
              <li><a href="../../../../../modules/src/main.html">main</a></li>
              <li><a href="../../../../../modules/src/strings.html">strings</a></li>
              <li><a href="../../../../../modules/src/xorigin.html">xorigin</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_command"><i class="icon-folder-open"></i>src\command</a>
              </li>
            </ul>
            <ul id="package_src_command" class="nav nav-list">
              <li><a href="../../../../../modules/src/command/CommandManager.html">CommandManager</a></li>
              <li><a href="../../../../../modules/src/command/Commands.html">Commands</a></li>
              <li><a href="../../../../../modules/src/command/DefaultMenus.html">DefaultMenus</a></li>
              <li><a href="../../../../../modules/src/command/KeyBindingManager.html">KeyBindingManager</a></li>
              <li><a href="../../../../../modules/src/command/Menus.html">Menus</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_document"><i class="icon-folder-open"></i>src\document</a>
              </li>
            </ul>
            <ul id="package_src_document" class="nav nav-list">
              <li><a href="../../../../../modules/src/document/ChangedDocumentTracker.html">ChangedDocumentTracker</a></li>
              <li><a href="../../../../../modules/src/document/Document.html">Document</a></li>
              <li><a href="../../../../../modules/src/document/DocumentCommandHandlers.html">DocumentCommandHandlers</a></li>
              <li><a href="../../../../../modules/src/document/DocumentManager.html">DocumentManager</a></li>
              <li><a href="../../../../../modules/src/document/InMemoryFile.html">InMemoryFile</a></li>
              <li><a href="../../../../../modules/src/document/TextRange.html">TextRange</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_editor"><i class="icon-folder-open"></i>src\editor</a>
              </li>
            </ul>
            <ul id="package_src_editor" class="nav nav-list">
              <li><a href="../../../../../modules/src/editor/CodeHintList.html">CodeHintList</a></li>
              <li><a href="../../../../../modules/src/editor/CodeHintManager.html">CodeHintManager</a></li>
              <li><a href="../../../../../modules/src/editor/CSSInlineEditor.html">CSSInlineEditor</a></li>
              <li><a href="../../../../../modules/src/editor/Editor.html">Editor</a></li>
              <li><a href="../../../../../modules/src/editor/EditorCommandHandlers.html">EditorCommandHandlers</a></li>
              <li><a href="../../../../../modules/src/editor/EditorManager.html">EditorManager</a></li>
              <li><a href="../../../../../modules/src/editor/EditorOptionHandlers.html">EditorOptionHandlers</a></li>
              <li><a href="../../../../../modules/src/editor/EditorStatusBar.html">EditorStatusBar</a></li>
              <li><a href="../../../../../modules/src/editor/ImageViewer.html">ImageViewer</a></li>
              <li><a href="../../../../../modules/src/editor/InlineTextEditor.html">InlineTextEditor</a></li>
              <li><a href="../../../../../modules/src/editor/InlineWidget.html">InlineWidget</a></li>
              <li><a href="../../../../../modules/src/editor/MultiRangeInlineEditor.html">MultiRangeInlineEditor</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_extensibility"><i class="icon-folder-open"></i>src\extensibility</a>
              </li>
            </ul>
            <ul id="package_src_extensibility" class="nav nav-list">
              <li><a href="../../../../../modules/src/extensibility/ExtensionManager.html">ExtensionManager</a></li>
              <li><a href="../../../../../modules/src/extensibility/ExtensionManagerDialog.html">ExtensionManagerDialog</a></li>
              <li><a href="../../../../../modules/src/extensibility/ExtensionManagerView.html">ExtensionManagerView</a></li>
              <li><a href="../../../../../modules/src/extensibility/ExtensionManagerViewModel.html">ExtensionManagerViewModel</a></li>
              <li><a href="../../../../../modules/src/extensibility/InstallExtensionDialog.html">InstallExtensionDialog</a></li>
              <li><a href="../../../../../modules/src/extensibility/Package.html">Package</a></li>
              <li><a href="../../../../../modules/src/extensibility/registry_utils.html">registry_utils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_file"><i class="icon-folder-open"></i>src\file</a>
              </li>
            </ul>
            <ul id="package_src_file" class="nav nav-list">
              <li><a href="../../../../../modules/src/file/FileUtils.html">FileUtils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_filesystem"><i class="icon-folder-open"></i>src\filesystem</a>
              </li>
            </ul>
            <ul id="package_src_filesystem" class="nav nav-list">
              <li><a href="../../../../../modules/src/filesystem/Directory.html">Directory</a></li>
              <li><a href="../../../../../modules/src/filesystem/File.html">File</a></li>
              <li><a href="../../../../../modules/src/filesystem/FileIndex.html">FileIndex</a></li>
              <li><a href="../../../../../modules/src/filesystem/FileSystem.html">FileSystem</a></li>
              <li><a href="../../../../../modules/src/filesystem/FileSystemEntry.html">FileSystemEntry</a></li>
              <li><a href="../../../../../modules/src/filesystem/FileSystemError.html">FileSystemError</a></li>
              <li><a href="../../../../../modules/src/filesystem/FileSystemStats.html">FileSystemStats</a></li>
              <li><a href="../../../../../modules/src/filesystem/WatchedRoot.html">WatchedRoot</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_filesystem_impls_appshell"><i class="icon-folder-open"></i>src\filesystem\impls\appshell</a>
              </li>
            </ul>
            <ul id="package_src_filesystem_impls_appshell" class="nav nav-list">
              <li><a href="../../../../../modules/src/filesystem/impls/appshell/AppshellFileSystem.html">AppshellFileSystem</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_filesystem_impls_appshell_node"><i class="icon-folder-open"></i>src\filesystem\impls\appshell\node</a>
              </li>
            </ul>
            <ul id="package_src_filesystem_impls_appshell_node" class="nav nav-list">
              <li><a href="../../../../../modules/src/filesystem/impls/appshell/node/ChokidarWatcher.html">ChokidarWatcher</a></li>
              <li><a href="../../../../../modules/src/filesystem/impls/appshell/node/CSharpWatcher.html">CSharpWatcher</a></li>
              <li><a href="../../../../../modules/src/filesystem/impls/appshell/node/FileWatcherDomain.html">FileWatcherDomain</a></li>
              <li><a href="../../../../../modules/src/filesystem/impls/appshell/node/FileWatcherManager.html">FileWatcherManager</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_help"><i class="icon-folder-open"></i>src\help</a>
              </li>
            </ul>
            <ul id="package_src_help" class="nav nav-list">
              <li><a href="../../../../../modules/src/help/HelpCommandHandlers.html">HelpCommandHandlers</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_JSUtils"><i class="icon-folder-open"></i>src\JSUtils</a>
              </li>
            </ul>
            <ul id="package_src_JSUtils" class="nav nav-list">
              <li><a href="../../../../../modules/src/JSUtils/HintUtils.html">HintUtils</a></li>
              <li><a href="../../../../../modules/src/JSUtils/MessageIds.html">MessageIds</a></li>
              <li><a href="../../../../../modules/src/JSUtils/Preferences.html">Preferences</a></li>
              <li><a href="../../../../../modules/src/JSUtils/ScopeManager.html">ScopeManager</a></li>
              <li><a href="../../../../../modules/src/JSUtils/Session.html">Session</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_JSUtils_node"><i class="icon-folder-open"></i>src\JSUtils\node</a>
              </li>
            </ul>
            <ul id="package_src_JSUtils_node" class="nav nav-list">
              <li><a href="../../../../../modules/src/JSUtils/node/ExtractFileContent.html">ExtractFileContent</a></li>
              <li><a href="../../../../../modules/src/JSUtils/node/TernNodeDomain.html">TernNodeDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_language"><i class="icon-folder-open"></i>src\language</a>
              </li>
            </ul>
            <ul id="package_src_language" class="nav nav-list">
              <li><a href="../../../../../modules/src/language/CodeInspection.html">CodeInspection</a></li>
              <li><a href="../../../../../modules/src/language/CSSUtils.html">CSSUtils</a></li>
              <li><a href="../../../../../modules/src/language/HTMLDOMDiff.html">HTMLDOMDiff</a></li>
              <li><a href="../../../../../modules/src/language/HTMLInstrumentation.html">HTMLInstrumentation</a></li>
              <li><a href="../../../../../modules/src/language/HTMLSimpleDOM.html">HTMLSimpleDOM</a></li>
              <li><a href="../../../../../modules/src/language/HTMLTokenizer.html">HTMLTokenizer</a></li>
              <li><a href="../../../../../modules/src/language/HTMLUtils.html">HTMLUtils</a></li>
              <li><a href="../../../../../modules/src/language/JSONUtils.html">JSONUtils</a></li>
              <li><a href="../../../../../modules/src/language/JSUtils.html">JSUtils</a></li>
              <li><a href="../../../../../modules/src/language/LanguageManager.html">LanguageManager</a></li>
              <li><a href="../../../../../modules/src/language/XMLUtils.html">XMLUtils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_Agents"><i class="icon-folder-open"></i>src\LiveDevelopment\Agents</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_Agents" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/ConsoleAgent.html">ConsoleAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/CSSAgent.html">CSSAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/DOMAgent.html">DOMAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/DOMHelpers.html">DOMHelpers</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/DOMNode.html">DOMNode</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/EditAgent.html">EditAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/GotoAgent.html">GotoAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/HighlightAgent.html">HighlightAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/NetworkAgent.html">NetworkAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/RemoteAgent.html">RemoteAgent</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/RemoteFunctions.html">RemoteFunctions</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Agents/ScriptAgent.html">ScriptAgent</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_Documents"><i class="icon-folder-open"></i>src\LiveDevelopment\Documents</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_Documents" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/Documents/CSSDocument.html">CSSDocument</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Documents/CSSPreprocessorDocument.html">CSSPreprocessorDocument</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Documents/HTMLDocument.html">HTMLDocument</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Documents/JSDocument.html">JSDocument</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_Inspector"><i class="icon-folder-open"></i>src\LiveDevelopment\Inspector</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_Inspector" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/Inspector/Inspector.html">Inspector</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment"><i class="icon-folder-open"></i>src\LiveDevelopment</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/LiveDevelopment.html">LiveDevelopment</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/LiveDevelopmentUtils.html">LiveDevelopmentUtils</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/LiveDevMultiBrowser.html">LiveDevMultiBrowser</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/LiveDevServerManager.html">LiveDevServerManager</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/main.html">main</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_documents"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\documents</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_documents" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/documents/LiveCSSDocument.html">LiveCSSDocument</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/documents/LiveDocument.html">LiveDocument</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/documents/LiveHTMLDocument.html">LiveHTMLDocument</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_language"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\language</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_language" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/language/HTMLInstrumentation.html">HTMLInstrumentation</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/language/HTMLSimpleDOM.html">HTMLSimpleDOM</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_launchers"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\launchers</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_launchers" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/launchers/Launcher.html">Launcher</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_launchers_node"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\launchers\node</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_launchers_node" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/launchers/node/LauncherDomain.html">LauncherDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_protocol"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\protocol</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_protocol" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/protocol/LiveDevProtocol.html">LiveDevProtocol</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_protocol_remote"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\protocol\remote</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_protocol_remote" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/protocol/remote/DocumentObserver.html">DocumentObserver</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/protocol/remote/LiveDevProtocolRemote.html">LiveDevProtocolRemote</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_transports_node"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\transports\node</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_transports_node" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/transports/node/NodeSocketTransportDomain.html">NodeSocketTransportDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_transports"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\transports</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_transports" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/transports/NodeSocketTransport.html">NodeSocketTransport</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_MultiBrowserImpl_transports_remote"><i class="icon-folder-open"></i>src\LiveDevelopment\MultiBrowserImpl\transports\remote</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_MultiBrowserImpl_transports_remote" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/MultiBrowserImpl/transports/remote/NodeSocketTransportRemote.html">NodeSocketTransportRemote</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_Servers"><i class="icon-folder-open"></i>src\LiveDevelopment\Servers</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_Servers" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/Servers/BaseServer.html">BaseServer</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Servers/FileServer.html">FileServer</a></li>
              <li><a href="../../../../../modules/src/LiveDevelopment/Servers/UserServer.html">UserServer</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_transports_node"><i class="icon-folder-open"></i>src\LiveDevelopment\transports\node</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_transports_node" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/transports/node/WebSocketTransportDomain.html">WebSocketTransportDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_LiveDevelopment_transports"><i class="icon-folder-open"></i>src\LiveDevelopment\transports</a>
              </li>
            </ul>
            <ul id="package_src_LiveDevelopment_transports" class="nav nav-list">
              <li><a href="../../../../../modules/src/LiveDevelopment/transports/WebSocketTransport.html">WebSocketTransport</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_preferences"><i class="icon-folder-open"></i>src\preferences</a>
              </li>
            </ul>
            <ul id="package_src_preferences" class="nav nav-list">
              <li><a href="../../../../../modules/src/preferences/PreferencesBase.html">PreferencesBase</a></li>
              <li><a href="../../../../../modules/src/preferences/PreferencesDialogs.html">PreferencesDialogs</a></li>
              <li><a href="../../../../../modules/src/preferences/PreferencesImpl.html">PreferencesImpl</a></li>
              <li><a href="../../../../../modules/src/preferences/PreferencesManager.html">PreferencesManager</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_project"><i class="icon-folder-open"></i>src\project</a>
              </li>
            </ul>
            <ul id="package_src_project" class="nav nav-list">
              <li><a href="../../../../../modules/src/project/FileSyncManager.html">FileSyncManager</a></li>
              <li><a href="../../../../../modules/src/project/FileTreeView.html">FileTreeView</a></li>
              <li><a href="../../../../../modules/src/project/FileTreeViewModel.html">FileTreeViewModel</a></li>
              <li><a href="../../../../../modules/src/project/FileViewController.html">FileViewController</a></li>
              <li><a href="../../../../../modules/src/project/ProjectManager.html">ProjectManager</a></li>
              <li><a href="../../../../../modules/src/project/ProjectModel.html">ProjectModel</a></li>
              <li><a href="../../../../../modules/src/project/SidebarView.html">SidebarView</a></li>
              <li><a href="../../../../../modules/src/project/WorkingSetSort.html">WorkingSetSort</a></li>
              <li><a href="../../../../../modules/src/project/WorkingSetView.html">WorkingSetView</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_search"><i class="icon-folder-open"></i>src\search</a>
              </li>
            </ul>
            <ul id="package_src_search" class="nav nav-list">
              <li><a href="../../../../../modules/src/search/FileFilters.html">FileFilters</a></li>
              <li><a href="../../../../../modules/src/search/FindBar.html">FindBar</a></li>
              <li><a href="../../../../../modules/src/search/FindInFiles.html">FindInFiles</a></li>
              <li><a href="../../../../../modules/src/search/FindInFilesUI.html">FindInFilesUI</a></li>
              <li><a href="../../../../../modules/src/search/FindReplace.html">FindReplace</a></li>
              <li><a href="../../../../../modules/src/search/FindUtils.html">FindUtils</a></li>
              <li><a href="../../../../../modules/src/search/QuickOpen.html">QuickOpen</a></li>
              <li><a href="../../../../../modules/src/search/QuickOpenHelper.html">QuickOpenHelper</a></li>
              <li><a href="../../../../../modules/src/search/QuickSearchField.html">QuickSearchField</a></li>
              <li><a href="../../../../../modules/src/search/ScrollTrackMarkers.html">ScrollTrackMarkers</a></li>
              <li><a href="../../../../../modules/src/search/SearchModel.html">SearchModel</a></li>
              <li><a href="../../../../../modules/src/search/SearchResultsView.html">SearchResultsView</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_search_node"><i class="icon-folder-open"></i>src\search\node</a>
              </li>
            </ul>
            <ul id="package_src_search_node" class="nav nav-list">
              <li><a href="../../../../../modules/src/search/node/FindInFilesDomain.html">FindInFilesDomain</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_utils"><i class="icon-folder-open"></i>src\utils</a>
              </li>
            </ul>
            <ul id="package_src_utils" class="nav nav-list">
              <li><a href="../../../../../modules/src/utils/AnimationUtils.html">AnimationUtils</a></li>
              <li><a href="../../../../../modules/src/utils/AppInit.html">AppInit</a></li>
              <li><a href="../../../../../modules/src/utils/Async.html">Async</a></li>
              <li><a href="../../../../../modules/src/utils/BuildInfoUtils.html">BuildInfoUtils</a></li>
              <li><a href="../../../../../modules/src/utils/ColorUtils.html">ColorUtils</a></li>
              <li><a href="../../../../../modules/src/utils/Compatibility.html">Compatibility</a></li>
              <li><a href="../../../../../modules/src/utils/DeprecationWarning.html">DeprecationWarning</a></li>
              <li><a href="../../../../../modules/src/utils/DragAndDrop.html">DragAndDrop</a></li>
              <li><a href="../../../../../modules/src/utils/DropdownEventHandler.html">DropdownEventHandler</a></li>
              <li><a href="../../../../../modules/src/utils/EventDispatcher.html">EventDispatcher</a></li>
              <li><a href="../../../../../modules/src/utils/ExtensionLoader.html">ExtensionLoader</a></li>
              <li><a href="../../../../../modules/src/utils/ExtensionUtils.html">ExtensionUtils</a></li>
              <li><a href="../../../../../modules/src/utils/Global.html">Global</a></li>
              <li><a href="../../../../../modules/src/utils/HealthLogger.html">HealthLogger</a></li>
              <li><a href="../../../../../modules/src/utils/KeyEvent.html">KeyEvent</a></li>
              <li><a href="../../../../../modules/src/utils/LocalizationUtils.html">LocalizationUtils</a></li>
              <li><a href="../../../../../modules/src/utils/NativeApp.html">NativeApp</a></li>
              <li><a href="../../../../../modules/src/utils/NodeConnection.html">NodeConnection</a></li>
              <li><a href="../../../../../modules/src/utils/NodeDomain.html">NodeDomain</a></li>
              <li><a href="../../../../../modules/src/utils/PerfUtils.html">PerfUtils</a></li>
              <li><a href="../../../../../modules/src/utils/Resizer.html">Resizer</a></li>
              <li><a href="../../../../../modules/src/utils/ShellAPI.html">ShellAPI</a></li>
              <li><a href="../../../../../modules/src/utils/StringMatch.html">StringMatch</a></li>
              <li><a href="../../../../../modules/src/utils/StringUtils.html">StringUtils</a></li>
              <li><a href="../../../../../modules/src/utils/TokenUtils.html">TokenUtils</a></li>
              <li><a href="../../../../../modules/src/utils/UpdateNotification.html">UpdateNotification</a></li>
              <li><a href="../../../../../modules/src/utils/UrlParams.html">UrlParams</a></li>
              <li><a href="../../../../../modules/src/utils/ValidationUtils.html">ValidationUtils</a></li>
              <li><a href="../../../../../modules/src/utils/ViewUtils.html">ViewUtils</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_view"><i class="icon-folder-open"></i>src\view</a>
              </li>
            </ul>
            <ul id="package_src_view" class="nav nav-list">
              <li><a href="../../../../../modules/src/view/MainViewFactory.html">MainViewFactory</a></li>
              <li><a href="../../../../../modules/src/view/MainViewManager.html">MainViewManager</a></li>
              <li><a href="../../../../../modules/src/view/Pane.html">Pane</a></li>
              <li><a href="../../../../../modules/src/view/ThemeManager.html">ThemeManager</a></li>
              <li><a href="../../../../../modules/src/view/ThemeSettings.html">ThemeSettings</a></li>
              <li><a href="../../../../../modules/src/view/ThemeView.html">ThemeView</a></li>
              <li><a href="../../../../../modules/src/view/ViewCommandHandlers.html">ViewCommandHandlers</a></li>
              <li><a href="../../../../../modules/src/view/ViewStateManager.html">ViewStateManager</a></li>
              <li><a href="../../../../../modules/src/view/WorkspaceManager.html">WorkspaceManager</a></li>
            </ul>
            <ul class="nav nav-list package-list">
              <li class="nav-header">
                <a href="javascript:;" class="toggle-package" data-package="package_src_widgets"><i class="icon-folder-open"></i>src\widgets</a>
              </li>
            </ul>
            <ul id="package_src_widgets" class="nav nav-list">
              <li><a href="../../../../../modules/src/widgets/bootstrap-alerts.html">bootstrap-alerts</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-button.html">bootstrap-button</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-dropdown.html">bootstrap-dropdown</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-modal.html">bootstrap-modal</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-popover.html">bootstrap-popover</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-scrollspy.html">bootstrap-scrollspy</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-tab.html">bootstrap-tab</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-tooltip.html">bootstrap-tooltip</a></li>
              <li><a href="../../../../../modules/src/widgets/bootstrap-twipsy-mod.html">bootstrap-twipsy-mod</a></li>
              <li><a href="../../../../../modules/src/widgets/DefaultDialogs.html">DefaultDialogs</a></li>
              <li><a href="../../../../../modules/src/widgets/Dialogs.html">Dialogs</a></li>
              <li><a href="../../../../../modules/src/widgets/DropdownButton.html">DropdownButton</a></li>
              <li><a href="../../../../../modules/src/widgets/InlineMenu.html">InlineMenu</a></li>
              <li><a href="../../../../../modules/src/widgets/ModalBar.html">ModalBar</a></li>
              <li><a href="../../../../../modules/src/widgets/PopUpManager.html">PopUpManager</a></li>
              <li><a href="../../../../../modules/src/widgets/StatusBar.html">StatusBar</a></li>
            </ul>
          </div>
        </div>
        <div class="module span9">
<h1>HTMLInstrumentation</h1>


<section class="description">
    <h3>Description</h3>
    
    <div><p>HTMLInstrumentation</p>
<p>This module contains functions for &quot;instrumenting&quot; html code so that we can track
the relationship of source code to DOM nodes in the browser. This functionality is
used by both live highlighting and live HTML editing.</p>
<p>During live HTML development, the HTML source code is parsed to identify tag boundaries.
Each tag is assigned an ID which is stored in markers that are inserted into the editor.
These IDs are also included in &quot;data-brackets-id&quot; attributes that are inserted in the
HTML code that&#39;s served to the browser via the Live Development server.</p>
<p>The primary function for that functionality is generateInstrumentedHTML(). This does just
what it says - it will read the HTML content in the doc and generate instrumented code by
injecting &quot;data-brackets-id&quot; attributes. Additionally, it caches the parsed DOM for use
by future updates.</p>
<p>As the user makes edits in the editor, we determine how the DOM structure should change
based on the edits to the source code; those edits are generated by getUnappliedEditList().
HTMLDocument (in LiveDevelopment) takes those edits and sends them to the browser (via
RemoteFunctions) so that the DOM structure in the live preview can be updated accordingly.</p>
<p>There are also helper functions for returning the tagID associated with a specified
position in the document--this is used in live highlighting.</p>
</div>
    
</section>

<section id="dependencies">
    <h3>Dependencies</h3>

    <ul class="nav nav-list">
        <li><a href="..&#x2F;..&#x2F;..&#x2F;..&#x2F;../modules/document/DocumentManager.html">DocumentManager</a></li>
        <li><a href="..&#x2F;..&#x2F;..&#x2F;..&#x2F;../modules/language/HTMLDOMDiff.html">HTMLDOMDiff</a></li>
        <li><a href="..&#x2F;..&#x2F;..&#x2F;..&#x2F;../modules/LiveDevelopment/MultiBrowserImpl/language/HTMLSimpleDOM.html">HTMLSimpleDOM</a></li>
    </ul>

</section>

<section id="functions">

    <h3>Functions 
<label class="checkbox">
    <input class="toggle-public" type="checkbox"> Show Private Members
</label>    </h3>

<div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _getBrowserDiff 
        <a class="anchor" href="#-_getBrowserDiff" id="-_getBrowserDiff"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd></dd>
    <dt>
        browserSimpleDOM
        <span class="label label-info">Object</span>
    </dt>
    <dd></dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getBrowserDiff(editor, browserSimpleDOM) {
        var cachedValue = _cachedValues[editor.document.file.fullPath],
            editorRoot  = cachedValue.dom,
            browserRoot;

        browserRoot = _processBrowserSimpleDOM(browserSimpleDOM, editorRoot.tagID);

        return {
            diff    : HTMLDOMDiff.domdiff(editorRoot, browserRoot),
            browser : browserRoot,
            editor  : editorRoot
        };
    }

    DocumentManager.on(&quot;beforeDocumentDelete&quot;, _removeDocFromCache);</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _getMarkerAtDocumentPos 
        <a class="anchor" href="#-_getMarkerAtDocumentPos" id="-_getMarkerAtDocumentPos"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>The editor containing the instrumented document.</dd>
    <dt>
        pos
        <span class="label label-info">{line: number,ch: number}</span>
    </dt>
    <dd>The position to find the DOM marker for.</dd>
    <dt>
        preferParent
        <span class="label label-info">boolean</span>
    </dt>
    <dd>If true, and the pos is at one or the other edge of the innermost marked range, return the immediately enclosing mark instead.</dd>
    <dt>
        markCache
        <span class="label label-optional">optional</span>
        <span class="label label-info">Object</span>
    </dt>
    <dd>An optional cache to look up positions of existing markers. (This avoids calling the find() operation on marks multiple times, which is expensive.)</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">Object</span></dt>
    <dd>The CodeMirror mark object that represents the DOM node at the given position.</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getMarkerAtDocumentPos(editor, pos, preferParent, markCache) {
        var marks, match;

        markCache = markCache || {};
        marks = _getSortedTagMarks(editor._codeMirror.findMarksAt(pos), markCache);
        if (!marks.length) {
            return null;
        }

        &#x2F;&#x2F; The mark with the latest start is the innermost one.
        match = marks[marks.length - 1];
        if (preferParent) {
            &#x2F;&#x2F; If the match is exactly at the edge of the range and preferParent is set,
            &#x2F;&#x2F; we want to pop upwards.
            if (_posEq(match.range.from, pos) || _posEq(match.range.to, pos)) {
                if (marks.length &gt; 1) {
                    match = marks[marks.length - 2];
                } else {
                    &#x2F;&#x2F; We must be outside the root, so there&#39;s no containing tag.
                    match = null;
                }
            }
        }

        return match.mark;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _getSortedTagMarks 
        <a class="anchor" href="#-_getSortedTagMarks" id="-_getSortedTagMarks"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        marks
        <span class="label label-info">Array</span>
    </dt>
    <dd>An array of mark objects returned by CodeMirror.</dd>
    <dt>
        markCache
        <span class="label label-info">Object</span>
    </dt>
    <dd>An object that maps tag IDs to {mark, range} objects. If a mark in the marks array is already in the cache, we use the cached range info, otherwise we look up its range in CodeMirror and store it in the cache.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">Array.&lt;{mark: Object,range: {line: number,ch: number}}&gt;</span></dt>
    <dd>The filtered and sorted array of mark info objects (each of which contains the mark and its range, so the range doesn't need to be looked up again).</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getSortedTagMarks(marks, markCache) {
        marks = marks.filter(function (mark) {
            return !!mark.tagID;
        }).map(function (mark) {
            &#x2F;&#x2F; All marks should exist since we just got them from CodeMirror.
            if (!markCache[mark.tagID]) {
                markCache[mark.tagID] = {mark: mark, range: mark.find()};
            }
            return markCache[mark.tagID];
        });
        marks.sort(function (mark1, mark2) {
            return (mark1.range.from.line === mark2.range.from.line ?
                    mark1.range.from.ch - mark2.range.from.ch :
                    mark1.range.from.line - mark2.range.from.line);
        });

        return marks;
    }</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _getTagIDAtDocumentPos 
        <a class="anchor" href="#-_getTagIDAtDocumentPos" id="-_getTagIDAtDocumentPos"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Get the instrumented tagID at the specified position. Returns -1 if
there are no instrumented tags at the location.
The _markText() function must be called before calling this function.</p>
<p>NOTE: This function is &quot;private&quot; for now (has a leading underscore), since
the API is likely to change in the future.</p>
</div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>The editor to scan.</dd>
    <dt>
        pos
        <span class="label label-info">{line: number,ch: number}</span>
    </dt>
    <dd>The position to find the DOM marker for.</dd>
    <dt>
        markCache
        <span class="label label-optional">optional</span>
        <span class="label label-info">Object</span>
    </dt>
    <dd>An optional cache to look up positions of existing markers. (This avoids calling the find() operation on marks multiple times, which is expensive.)</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">number</span></dt>
    <dd>tagID at the specified position, or -1 if there is no tag</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _getTagIDAtDocumentPos(editor, pos, markCache) {
        var match = _getMarkerAtDocumentPos(editor, pos, false, markCache);

        return (match) ? match.tagID : -1;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _hasAncestorWithID 
        <a class="anchor" href="#-_hasAncestorWithID" id="-_hasAncestorWithID"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        node
        <span class="label label-info">Object</span>
    </dt>
    <dd>A node from an HTMLSimpleDOM structure.</dd>
    <dt>
        id
        <span class="label label-info">number</span>
    </dt>
    <dd>The ID of the tag to check for.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">boolean</span></dt>
    <dd>true if the node has an ancestor with that ID.</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _hasAncestorWithID(node, id) {
        var ancestor = node.parent;
        while (ancestor &amp;&amp; ancestor.tagID !== id) {
            ancestor = ancestor.parent;
        }
        return !!ancestor;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _markTags 
        <a class="anchor" href="#-_markTags" id="-_markTags"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Recursively walks the SimpleDOM starting at node and marking
all tags in the CodeMirror instance. The more useful interface
is the _markTextFromDOM function which clears existing marks
before calling this function to create new ones.</p>
</div>
    
<dl>
    <dt>
        cm
        <span class="label label-info">CodeMirror</span>
    </dt>
    <dd>CodeMirror instance in which to mark tags</dd>
    <dt>
        node
        <span class="label label-info">Object</span>
    </dt>
    <dd>SimpleDOM node to use as the root for marking</dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _markTags(cm, node) {
        node.children.forEach(function (childNode) {
            if (childNode.isElement()) {
                _markTags(cm, childNode);
            }
        });
        var mark = cm.markText(node.startPos, node.endPos);
        mark.tagID = node.tagID;
    }</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _markText 
        <a class="anchor" href="#-_markText" id="-_markText"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Mark the text for the specified editor. Either scanDocument() or
generateInstrumentedHTML() must be called before this function
is called.</p>
<p>NOTE: This function is &quot;private&quot; for now (has a leading underscore), since
the API is likely to change in the future.</p>
</div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>The editor whose text should be marked.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">none</span></dt>
    <dd></dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _markText(editor) {
        var cache = _cachedValues[editor.document.file.fullPath],
            dom = cache &amp;&amp; cache.dom;

        if (!dom) {
            console.error(&quot;Couldn&#39;t find the dom for &quot; + editor.document.file.fullPath);
            return;
        } else if (!dom.fullBuild) {
            console.error(&quot;Tried to mark text from a stale DOM for &quot; + editor.document.file.fullPath);
            return;
        }

        _markTextFromDOM(editor, dom);
    }</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _markTextFromDOM 
        <a class="anchor" href="#-_markTextFromDOM" id="-_markTextFromDOM"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Clears the marks from the document and creates new ones.</p>
</div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>Editor object holding this document</dd>
    <dt>
        dom
        <span class="label label-info">Object</span>
    </dt>
    <dd>SimpleDOM root object that contains the parsed structure</dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _markTextFromDOM(editor, dom) {
        var cm = editor._codeMirror;

        &#x2F;&#x2F; Remove existing marks
        var marks = cm.getAllMarks();
        cm.operation(function () {
            marks.forEach(function (mark) {
                if (mark.hasOwnProperty(&quot;tagID&quot;)) {
                    mark.clear();
                }
            });
        });

        &#x2F;&#x2F; Mark
        _markTags(cm, dom);
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _posEq 
        <a class="anchor" href="#-_posEq" id="-_posEq"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        pos1
        <span class="label label-info">{line: number,ch: number}</span>
    </dt>
    <dd></dd>
    <dt>
        pos2
        <span class="label label-info">{line: number,ch: number}</span>
    </dt>
    <dd></dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">boolean</span></dt>
    <dd>true if pos1 and pos2 are equal. Fails if either of them is falsy.</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _posEq(pos1, pos2) {
        return pos1 &amp;&amp; pos2 &amp;&amp; pos1.line === pos2.line &amp;&amp; pos1.ch === pos2.ch;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _processBrowserSimpleDOM 
        <a class="anchor" href="#-_processBrowserSimpleDOM" id="-_processBrowserSimpleDOM"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        root
        <span class="label label-info">Object</span>
    </dt>
    <dd></dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _processBrowserSimpleDOM(browserRoot, editorRootTagID) {
        var nodeMap         = {},
            root;

        function _processElement(elem) {
            elem.tagID = elem.attributes[&quot;data-brackets-id&quot;];

            &#x2F;&#x2F; remove data-brackets-id attribute for diff
            delete elem.attributes[&quot;data-brackets-id&quot;];

            elem.children.forEach(function (child) {
                &#x2F;&#x2F; set parent
                child.parent = elem;

                if (child.isElement()) {
                    _processElement(child);
                } else if (child.isText()) {
                    child.update();
                    child.tagID = HTMLSimpleDOM.getTextNodeID(child);

                    nodeMap[child.tagID] = child;
                }
            });

            elem.update();

            nodeMap[elem.tagID] = elem;

            &#x2F;&#x2F; Choose the root element based on the root tag in the editor.
            &#x2F;&#x2F; The browser may insert html, head and body elements if missing.
            if (elem.tagID === editorRootTagID) {
                root = elem;
            }
        }

        _processElement(browserRoot);

        root = root || browserRoot;
        root.nodeMap = nodeMap;

        return root;
    }</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _removeDocFromCache 
        <a class="anchor" href="#-_removeDocFromCache" id="-_removeDocFromCache"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        event
        <span class="label label-info">$.Event</span>
    </dt>
    <dd>(unused)</dd>
    <dt>
        document
        <span class="label label-info">Document</span>
    </dt>
    <dd>The document to clear from the cache.</dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _removeDocFromCache(evt, document) {
        if (_cachedValues.hasOwnProperty(document.file.fullPath)) {
            delete _cachedValues[document.file.fullPath];
            document.off(&quot;.htmlInstrumentation&quot;);
        }
    }</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _resetCache 
        <a class="anchor" href="#-_resetCache" id="-_resetCache"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _resetCache() {
        _cachedValues = {};
    }

    &#x2F;&#x2F; private methods
    exports._markText                   = _markText;
    exports._getMarkerAtDocumentPos     = _getMarkerAtDocumentPos;
    exports._getTagIDAtDocumentPos      = _getTagIDAtDocumentPos;
    exports._markTextFromDOM            = _markTextFromDOM;
    exports._updateDOM                  = _updateDOM;
    exports._allowIncremental           = allowIncremental;
    exports._getBrowserDiff             = _getBrowserDiff;
    exports._resetCache                 = _resetCache;

    &#x2F;&#x2F; public API
    exports.scanDocument                = scanDocument;
    exports.generateInstrumentedHTML    = generateInstrumentedHTML;
    exports.getUnappliedEditList        = getUnappliedEditList;
});</code></pre></div><div class="member private public">

<span class="pull-right scope">
    Private
    Public API
</span>
    <h4>
        _updateDOM 
        <a class="anchor" href="#-_updateDOM" id="-_updateDOM"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        previousDOM
        <span class="label label-info">Object</span>
    </dt>
    <dd>The HTMLSimpleDOM corresponding to the previous state of the editor. Note that in the case of an incremental edit, this will be mutated to create the new DOM (by swapping out the subtree corresponding to the changed portion).</dd>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>The editor containing the instrumented HTML.</dd>
    <dt>
        changeList
        <span class="label label-optional">optional</span>
        <span class="label label-info">Array</span>
    </dt>
    <dd>If specified, a CodeMirror changelist reflecting all the text changes in the editor since previousDOM was built. If specified, we will attempt to do an incremental update (although we might fall back to a full update in various cases). If not specified, we will always do a full update.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">{dom: Object,edits: Array}</span></dt>
    <dd>The new DOM representing the current state of the editor, and an array of edits that can be applied to update the browser (see HTMLDOMDiff for more information on the edit format).</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function _updateDOM(previousDOM, editor, changeList) {
        if (!allowIncremental) {
            changeList = undefined;
        }
        var updater = new DOMUpdater(previousDOM, editor, changeList);
        var result = updater.update();
        if (!result) {
            return { errors: updater.errors };
        }

        var edits = HTMLDOMDiff.domdiff(result.oldSubtree, result.newSubtree);

        &#x2F;&#x2F; We&#39;re done with the nodeMap that was added to the subtree by the updater.
        if (result.newSubtree !== result.newDOM) {
            delete result.newSubtree.nodeMap;
        }

        return {
            dom: result.newDOM,
            edits: edits,
            _wasIncremental: updater.isIncremental &#x2F;&#x2F; for unit tests only
        };
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>
        generateInstrumentedHTML 
        <a class="anchor" href="#-generateInstrumentedHTML" id="-generateInstrumentedHTML"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Generate instrumented HTML for the specified editor&#39;s document, and mark the associated tag
ranges in the editor. Each tag has a &quot;data-brackets-id&quot; attribute with a unique ID for its
value. For example, &quot;&lt;div&gt;&quot; becomes something like &quot;&lt;div data-brackets-id=&#39;45&#39;&gt;&quot;. The attribute
value is just a number that is guaranteed to be unique.</p>
<p>Also stores marks in the given editor that correspond to the tag ranges. These marks are used
to track the DOM structure for in-browser highlighting and live HTML updating.</p>
<p>This only needs to be done once on load of a document. As the document is edited in memory,
the instrumentation is kept up to date via the diffs and edits that are generated on change
events. Call this again only if you want to do a full re-sync of the editor&#39;s DOM state.</p>
</div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>The editor whose document we're instrumenting, and which we should mark ranges in.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">string</span></dt>
    <dd>instrumented html content</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function generateInstrumentedHTML(editor, remoteScript) {
        var doc = editor.document,
            dom = scanDocument(doc),
            orig = doc.getText(),
            gen = &quot;&quot;,
            lastIndex = 0,
            remoteScriptInserted = false,
            markCache;

        if (!dom) {
            return null;
        }

        &#x2F;&#x2F; Ensure that the marks in the editor are up to date with respect to the given DOM.
        &#x2F;&#x2F; (But only do this if the dom we got back from scanDocument() was a full rebuild. Otherwise,
        &#x2F;&#x2F; rely on the marks in the editor.)
        if (dom.fullBuild) {
            _markTextFromDOM(editor, dom);
        } else {
            markCache = {};
            editor._codeMirror.getAllMarks().forEach(function (mark) {
                if (mark.tagID) {
                    markCache[mark.tagID] = { mark: mark, range: mark.find() };
                }
            });
        }

        &#x2F;&#x2F; Walk through the dom nodes and insert the &#39;data-brackets-id&#39; attribute at the
        &#x2F;&#x2F; end of the open tag
        function walk(node) {
            if (node.tag) {
                var attrText = &quot; data-brackets-id=&#39;&quot; + node.tagID + &quot;&#39;&quot;;

                &#x2F;&#x2F; If the dom was fully rebuilt, use its offsets. Otherwise, use the marks in the
                &#x2F;&#x2F; associated editor, since they&#39;ll be more up to date.
                var startOffset;
                if (dom.fullBuild) {
                    startOffset = node.start;
                } else {
                    var mark = markCache[node.tagID];
                    if (mark) {
                        startOffset = editor._codeMirror.indexFromPos(mark.range.from);
                    } else {
                        console.warn(&quot;generateInstrumentedHTML(): couldn&#39;t find existing mark for tagID &quot; + node.tagID);
                        startOffset = node.start;
                    }
                }

                &#x2F;&#x2F; Insert the attribute as the first attribute in the tag.
                var insertIndex = startOffset + node.tag.length + 1;
                gen += orig.substr(lastIndex, insertIndex - lastIndex) + attrText;
                lastIndex = insertIndex;

                &#x2F;&#x2F; If we have a script to inject and this is the head tag, inject it immediately
                &#x2F;&#x2F; after the open tag.
                if (remoteScript &amp;&amp; !remoteScriptInserted &amp;&amp; node.tag === &quot;head&quot;) {
                    insertIndex = node.openEnd;
                    gen += orig.substr(lastIndex, insertIndex - lastIndex) + remoteScript;
                    lastIndex = insertIndex;
                    remoteScriptInserted = true;
                }
            }

            if (node.isElement()) {
                node.children.forEach(walk);
            }
        }

        walk(dom);
        gen += orig.substr(lastIndex);

        if (remoteScript &amp;&amp; !remoteScriptInserted) {
            &#x2F;&#x2F; if the remote script couldn&#39;t be injected before (e.g. due to missing &quot;head&quot; tag),
            &#x2F;&#x2F; append it at the end
            gen += remoteScript;
        }

        return gen;
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>
        getUnappliedEditList 
        <a class="anchor" href="#-getUnappliedEditList" id="-getUnappliedEditList"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Calculates the DOM edits that are needed to update the browser from the state the
editor was in the last time that scanDocument(), getInstrumentedHTML(), or
getUnappliedEditList() was called (whichever is most recent). Caches this state so
it can be used as the base state for the next getUnappliedEditList().</p>
<p>For simple text edits, this update is done quickly and incrementally. For structural
edits (edits that change the DOM structure or add/remove attributes), the update
requires a full reparse.</p>
<p>If the document currently contains invalid HTML, no edits will be generated until
getUnappliedEditList() is called when the document is valid, at which point the edits
will reflect all the changes needed to catch the browser up with all the edits
made while the document was invalid.</p>
</div>
    
<dl>
    <dt>
        editor
        <span class="label label-info">Editor</span>
    </dt>
    <dd>The editor containing the instrumented HTML</dd>
    <dt>
        changeList
        <span class="label label-info">Array</span>
    </dt>
    <dd>A CodeMirror change list describing the text changes made in the editor since the last update. If specified, we will attempt to do an incremental update.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">Array</span></dt>
    <dd>edits A list of edits to apply in the browser. See HTMLDOMDiff for more information on the format of these edits.</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function getUnappliedEditList(editor, changeList) {
        var cachedValue = _cachedValues[editor.document.file.fullPath];

        &#x2F;&#x2F; We might not have a previous DOM if the document was empty before this edit.
        if (!cachedValue || !cachedValue.dom || _cachedValues[editor.document.file.fullPath].invalid) {
            &#x2F;&#x2F; We were in an invalid state, so do a full rebuild.
            changeList = null;
        }

        var result = _updateDOM(cachedValue &amp;&amp; cachedValue.dom, editor, changeList);

        if (!result.errors) {
            _cachedValues[editor.document.file.fullPath] = {
                timestamp: editor.document.diskTimestamp,
                dom: result.dom,
                dirty: false
            };
            &#x2F;&#x2F; Since this was an incremental update, we can&#39;t rely on the node start&#x2F;end offsets
            &#x2F;&#x2F; in the dom (because nodes after the updated portion didn&#39;t have their offsets
            &#x2F;&#x2F; updated); the marks in the editor are more accurate.
            &#x2F;&#x2F; TODO: should we consider ripping through the dom and fixing up other offsets?
            result.dom.fullBuild = false;
            return { edits: result.edits };
        } else {
            if (cachedValue) {
                cachedValue.invalid = true;
            }
            return { errors: result.errors };
        }
    }</code></pre></div><div class="member public">

<span class="pull-right scope">
    
    Public API
</span>
    <h4>
        scanDocument 
        <a class="anchor" href="#-scanDocument" id="-scanDocument"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Parses the document, returning an HTMLSimpleDOM structure and caching it as the
initial state of the document. Will return a cached copy of the DOM if the
document hasn&#39;t changed since the last time scanDocument was called.</p>
<p>This is called by generateInstrumentedHTML(), but it can be useful to call it
ahead of time so the DOM is cached and doesn&#39;t need to be rescanned when the
instrumented HTML is requested by the browser.</p>
</div>
    
<dl>
    <dt>
        doc
        <span class="label label-info">Document</span>
    </dt>
    <dd>The doc to scan.</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">Object</span></dt>
    <dd>Root DOM node of the document.</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    function scanDocument(doc) {
        if (!_cachedValues.hasOwnProperty(doc.file.fullPath)) {
            &#x2F;&#x2F; TODO: this doesn&#39;t seem to be correct any more. The DOM should never be &quot;dirty&quot; (i.e., out of sync
            &#x2F;&#x2F; with the editor) unless the doc is invalid.
&#x2F;&#x2F;            $(doc).on(&quot;change.htmlInstrumentation&quot;, function () {
&#x2F;&#x2F;                if (_cachedValues[doc.file.fullPath]) {
&#x2F;&#x2F;                    _cachedValues[doc.file.fullPath].dirty = true;
&#x2F;&#x2F;                }
&#x2F;&#x2F;            });

            &#x2F;&#x2F; Assign to cache, but don&#39;t set a value yet
            _cachedValues[doc.file.fullPath] = null;
        }

        var cachedValue = _cachedValues[doc.file.fullPath];
        &#x2F;&#x2F; TODO: No longer look at doc or cached value &quot;dirty&quot; settings, because even if the doc is dirty, the dom
        &#x2F;&#x2F; should generally be up to date unless the HTML is invalid. (However, the node offsets will be dirty of
        &#x2F;&#x2F; the dom was incrementally updated - we should note that somewhere.)
        if (cachedValue &amp;&amp; !cachedValue.invalid &amp;&amp; cachedValue.timestamp === doc.diskTimestamp) {
            return cachedValue.dom;
        }

        var text = doc.getText(),
            dom = HTMLSimpleDOM.build(text);

        if (dom) {
            &#x2F;&#x2F; Cache results
            _cachedValues[doc.file.fullPath] = {
                timestamp: doc.diskTimestamp,
                dom: dom,
                dirty: false
            };
            &#x2F;&#x2F; Note that this was a full build, so we know that we can trust the node start&#x2F;end offsets.
            dom.fullBuild = true;
        }

        return dom;
    }</code></pre></div>
</section>

<section id="classes">
    
    <h2>Classes</h2>

    <div class="well">
        <div class="member public">
            
            <span class="pull-right scope">Constructor</span>
            
            <h4>
                DOMUpdater
                
            </h4>
            
            <em></em>
            
            <dl>
                <dt>previousDOM <span class="label label-info pull-left">Object</span></dt>
                <dd>The root of the HTMLSimpleDOM tree representing a previous state of the DOM.</dd>
                <dt>editor <span class="label label-info pull-left">Editor</span></dt>
                <dd>The editor containing the instrumented HTML.</dd>
                <dt>changeList <span class="label label-info pull-left">Array</span></dt>
                <dd>An optional array of CodeMirror change records representing the edits the user made in the editor since previousDOM was built. If provided, and the edits are not structural, DOMUpdater will do a fast incremental reparse. If not provided, or if one of the edits changes the DOM structure, DOMUpdater will reparse the whole DOM.</dd>
            </dl>
          
<dl>
</dl>

            <button class="btn btn-small show-code">Show code</button>
            <pre class="code language-javascript"><code class="language-javascript">    function DOMUpdater(previousDOM, editor, changeList) {
        var text, startOffset = 0, startOffsetPos;

        this.isIncremental = false;

        function isDangerousEdit(text) {
            &#x2F;&#x2F; We don&#39;t consider &amp; dangerous since entities only affect text content, not
            &#x2F;&#x2F; overall DOM structure.
            return (&#x2F;[&lt;&gt;\&#x2F;=\&quot;\&#39;]&#x2F;).test(text);
        }

        &#x2F;&#x2F; If there&#39;s more than one change, be conservative and assume we have to do a full reparse.
        if (changeList &amp;&amp; changeList.length === 1) {
            &#x2F;&#x2F; If the inserted or removed text doesn&#39;t have any characters that could change the
            &#x2F;&#x2F; structure of the DOM (e.g. by adding or removing a tag boundary), then we can do
            &#x2F;&#x2F; an incremental reparse of just the parent tag containing the edit. This should just
            &#x2F;&#x2F; be the marked range that contains the beginning of the edit range, since that position
            &#x2F;&#x2F; isn&#39;t changed by the edit.
            var change = changeList[0];
            if (!isDangerousEdit(change.text) &amp;&amp; !isDangerousEdit(change.removed)) {
                &#x2F;&#x2F; If the edit is right at the beginning or end of a tag, we want to be conservative
                &#x2F;&#x2F; and use the parent as the edit range.
                var startMark = _getMarkerAtDocumentPos(editor, change.from, true);
                if (startMark) {
                    var range = startMark.find();
                    if (range) {
                        text = editor._codeMirror.getRange(range.from, range.to);
                        this.changedTagID = startMark.tagID;
                        startOffsetPos = range.from;
                        startOffset = editor._codeMirror.indexFromPos(startOffsetPos);
                        this.isIncremental = true;
                    }
                }
            }
        }

        if (!this.changedTagID) {
            &#x2F;&#x2F; We weren&#39;t able to incrementally update, so just rebuild and diff everything.
            text = editor.document.getText();
        }

        HTMLSimpleDOM.Builder.call(this, text, startOffset, startOffsetPos);
        this.editor = editor;
        this.cm = editor._codeMirror;
        this.previousDOM = previousDOM;
    }

    DOMUpdater.prototype = Object.create(HTMLSimpleDOM.Builder.prototype);</code></pre>
        </div>
        

        <section class="methods">

            <h3>Methods 
<label class="checkbox">
    <input class="toggle-public" type="checkbox"> Show Private Members
</label>            </h3>

<div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _buildNodeMap 
        <a class="anchor" href="#DOMUpdater-_buildNodeMap" id="DOMUpdater-_buildNodeMap"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        root
        <span class="label label-info">Object</span>
    </dt>
    <dd>The root of an HTMLSimpleDOM tree.</dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    DOMUpdater.prototype._buildNodeMap = function (root) {
        var nodeMap = {};

        function walk(node) {
            if (node.tagID) {
                nodeMap[node.tagID] = node;
            }
            if (node.isElement()) {
                node.children.forEach(walk);
            }
        }

        walk(root);
        root.nodeMap = nodeMap;
    };</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _handleDeletions 
        <a class="anchor" href="#DOMUpdater-_handleDeletions" id="DOMUpdater-_handleDeletions"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"></div>
    
<dl>
    <dt>
        nodeMap
        <span class="label label-info">Object</span>
    </dt>
    <dd>The nodeMap to update to remove deleted items.</dd>
    <dt>
        oldSubtreeMap
        <span class="label label-info">Object</span>
    </dt>
    <dd>The nodeMap for the original subtree (which should be a subset of the first nodeMap).</dd>
    <dt>
        newSubtreeMap
        <span class="label label-info">Object</span>
    </dt>
    <dd>The nodeMap for the new subtree.</dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    DOMUpdater.prototype._handleDeletions = function (nodeMap, oldSubtreeMap, newSubtreeMap) {
        var deletedIDs = [];
        Object.keys(oldSubtreeMap).forEach(function (key) {
            if (!newSubtreeMap.hasOwnProperty(key)) {
                deletedIDs.push(key);
                delete nodeMap[key];
            }
        });

        if (deletedIDs.length) {
            &#x2F;&#x2F; FUTURE: would be better to cache the mark for each node. Also, could
            &#x2F;&#x2F; conceivably combine this with _updateMarkedRanges().
            var marks = this.cm.getAllMarks();
            marks.forEach(function (mark) {
                if (mark.hasOwnProperty(&quot;tagID&quot;) &amp;&amp; deletedIDs.indexOf(mark.tagID) !== -1) {
                    mark.clear();
                }
            });
        }
    };</code></pre></div><div class="member private">

<span class="pull-right scope">
    Private
    
</span>
    <h4>
        _updateMarkedRanges 
        <a class="anchor" href="#DOMUpdater-_updateMarkedRanges" id="DOMUpdater-_updateMarkedRanges"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Updates the CodeMirror marks in the editor to reflect the new bounds of nodes in
the given nodeMap.</p>
</div>
    
<dl>
    <dt>
        nodeMap
        <span class="label label-info">Object</span>
    </dt>
    <dd>The node map from the new DOM.</dd>
    <dt>
        markCache
        <span class="label label-info">Object</span>
    </dt>
    <dd>The cache of existing mark ranges built during the latest parse.</dd>
</dl><dl>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    DOMUpdater.prototype._updateMarkedRanges = function (nodeMap, markCache) {
        &#x2F;&#x2F; FUTURE: this is somewhat inefficient (getting all the marks involves passing linearly through
        &#x2F;&#x2F; the document once), but it doesn&#39;t seem to be a hotspot right now.
        var updateIDs = Object.keys(nodeMap),
            cm = this.cm,
            marks = cm.getAllMarks();

        cm.operation(function () {
            marks.forEach(function (mark) {
                if (mark.hasOwnProperty(&quot;tagID&quot;) &amp;&amp; nodeMap[mark.tagID]) {
                    var node = nodeMap[mark.tagID],
                        markInfo = markCache[mark.tagID];
                    &#x2F;&#x2F; If the mark&#39;s bounds already match, avoid destroying and recreating the mark,
                    &#x2F;&#x2F; since that incurs some overhead.
                    if (!(markInfo &amp;&amp; _posEq(markInfo.range.from, node.startPos) &amp;&amp; _posEq(markInfo.range.to, node.endPos))) {
                        mark.clear();
                        mark = cm.markText(node.startPos, node.endPos);
                        mark.tagID = node.tagID;
                    }
                    updateIDs.splice(updateIDs.indexOf(String(node.tagID)), 1);
                }
            });

            &#x2F;&#x2F; Any remaining updateIDs are new.
            updateIDs.forEach(function (id) {
                var node = nodeMap[id], mark;
                if (node.isElement()) {
                    mark = cm.markText(node.startPos, node.endPos);
                    mark.tagID = Number(id);
                }
            });
        });
    };</code></pre></div><div class="member">

<span class="pull-right scope">
    
    
</span>
    <h4>
        getID 
        <a class="anchor" href="#DOMUpdater-getID" id="DOMUpdater-getID"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Overrides the <code>getID</code> method to return the tag ID from the document. If a viable tag
ID cannot be found in the document marks, then a new ID is returned. This will also
assign a new ID if the tag changed between the previous and current versions of this
node.</p>
</div>
    
<dl>
    <dt>
        newTag
        <span class="label label-info">Object</span>
    </dt>
    <dd>tag object for the current element</dd>
</dl><dl>
    <dt>Returns: <span class="label label-info">int</span></dt>
    <dd>best ID</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    DOMUpdater.prototype.getID = function (newTag, markCache) {
        &#x2F;&#x2F; Get the mark at the start of the tagname (not before the beginning of the tag, because that&#39;s
        &#x2F;&#x2F; actually inside the parent).
        var currentTagID = _getTagIDAtDocumentPos(this.editor, HTMLSimpleDOM._offsetPos(newTag.startPos, 1), markCache);

        &#x2F;&#x2F; If the new tag is in an unmarked range, or the marked range actually corresponds to an
        &#x2F;&#x2F; ancestor tag, then this must be a newly inserted tag, so give it a new tag ID.
        if (currentTagID === -1 || _hasAncestorWithID(newTag, currentTagID)) {
            currentTagID = this.getNewID();
        } else {
            &#x2F;&#x2F; If the tag has changed between the previous DOM and the new one, we assign a new ID
            &#x2F;&#x2F; so that the old tag will be deleted and the new one inserted.
            var oldNode = this.previousDOM.nodeMap[currentTagID];
            if (!oldNode || oldNode.tag !== newTag.tag) {
                currentTagID = this.getNewID();
            }
        }
        return currentTagID;
    };</code></pre></div><div class="member">

<span class="pull-right scope">
    
    
</span>
    <h4>
        update 
        <a class="anchor" href="#DOMUpdater-update" id="DOMUpdater-update"><span class="icon-link"></span></a>
    </h4>

    
    <div class="description"><p>Reparses the document (or a portion of it if we can do it incrementally).
Note that in an incremental update, the old DOM is actually mutated (the new
subtree is swapped in for the old subtree).</p>
</div>
    
<dl>
</dl><dl>
    <dt>Returns: <span class="label label-info">?{newDOM: Object,oldSubtree: Object,newSubtree: Object}</span></dt>
    <dd>newDOM is the full new DOM. For a full update, oldSubtree is the full old DOM and newSubtree is the same as newDOM; for an incremental update, oldSubtree is the portion of the old tree that was reparsed, newSubtree is the updated version, and newDOM is actually the same as the original DOM (with newSubtree swapped in for oldSubtree). If the document can't be parsed due to invalid HTML, returns null.</dd>
</dl><dl>
</dl><dl>
<dl><button class="btn btn-small show-code">Show code</button>
<pre class="code language-javascript"><code class="language-javascript">    DOMUpdater.prototype.update = function () {
        var markCache = {},
            newSubtree = this.build(true, markCache),
            result = {
                &#x2F;&#x2F; default result if we didn&#39;t identify a changed portion
                newDOM: newSubtree,
                oldSubtree: this.previousDOM,
                newSubtree: newSubtree
            };

        if (!newSubtree) {
            return null;
        }

        if (this.changedTagID) {
            &#x2F;&#x2F; Find the old subtree that&#39;s going to get swapped out.
            var oldSubtree = this.previousDOM.nodeMap[this.changedTagID],
                parent = oldSubtree.parent;

            &#x2F;&#x2F; If we didn&#39;t have a parent, then the whole tree changed anyway, so
            &#x2F;&#x2F; we&#39;ll just return the default result.
            if (parent) {
                var childIndex = parent.children.indexOf(oldSubtree);
                if (childIndex === -1) {
                    &#x2F;&#x2F; This should never happen...
                    console.error(&quot;DOMUpdater.update(): couldn&#39;t locate old subtree in tree&quot;);
                } else {
                    &#x2F;&#x2F; Swap the new subtree in place of the old subtree.
                    oldSubtree.parent = null;
                    newSubtree.parent = parent;
                    parent.children[childIndex] = newSubtree;

                    &#x2F;&#x2F; Overwrite any node mappings in the parent DOM with the
                    &#x2F;&#x2F; mappings for the new subtree. We keep the nodeMap around
                    &#x2F;&#x2F; on the new subtree so that the differ can use it later.
                    $.extend(this.previousDOM.nodeMap, newSubtree.nodeMap);

                    &#x2F;&#x2F; Update marked ranges for all items in the new subtree.
                    this._updateMarkedRanges(newSubtree.nodeMap, markCache);

                    &#x2F;&#x2F; Build a local nodeMap for the old subtree so the differ can
                    &#x2F;&#x2F; use it.
                    this._buildNodeMap(oldSubtree);

                    &#x2F;&#x2F; Clean up the info for any deleted nodes that are no longer in
                    &#x2F;&#x2F; the new tree.
                    this._handleDeletions(this.previousDOM.nodeMap, oldSubtree.nodeMap, newSubtree.nodeMap);

                    &#x2F;&#x2F; Update the signatures for all parents of the new subtree.
                    var curParent = parent;
                    while (curParent) {
                        curParent.update();
                        curParent = curParent.parent;
                    }

                    result.newDOM = this.previousDOM;
                    result.oldSubtree = oldSubtree;
                }
            }
        } else {
            _markTextFromDOM(this.editor, result.newDOM);
        }

        return result;
    };</code></pre></div>
        </section>

    </div>

</section>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="../../../../../assets/js/prism.js"></script>
  </body>
</html>